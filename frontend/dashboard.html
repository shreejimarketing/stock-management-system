<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="dashboard.css" />
    <link rel="stylesheet" href="navbar.css" />
  </head>
  <body>
    <nav>
      <ul>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="home.html">Edit</a></li>
        <li><a href="index.html" id="logout">Logout</a></li>
      </ul>
    </nav>
    <div id="navbar-placeholder"></div>
    <section>
      <h2>Champion Max</h2>
      <table class="full-width-table" border="1">
        <thead>
          <tr>
            <th></th>
            <th colspan="6">Thickness</th>
          </tr>
          <tr>
            <th>Size</th>
            <th>6mm</th>
            <th>8mm</th>
            <th>12mm</th>
            <th>18mm</th>
            <th>19mm B.B.</th>
            <th>25mm B.B.</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>8x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </section>
    <section>
      <h2>High Spirit</h2>
      <table class="full-width-table" border="1">
        <thead>
          <tr>
            <th></th>
            <th colspan="6">Thickness</th>
          </tr>
          <tr>
            <th>Size</th>
            <th>6mm</th>
            <th>8mm</th>
            <th>12mm</th>
            <th>18mm</th>
            <th>19mm B.B.</th>
            <th>25mm B.B.</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>8x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </section>
    <section>
      <h2>Benz Club</h2>
      <table class="full-width-table" border="1">
        <thead>
          <tr>
            <th></th>
            <th colspan="6">Thickness</th>
          </tr>
          <tr>
            <th>Size</th>
            <th>6mm</th>
            <th>8mm</th>
            <th>12mm</th>
            <th>18mm</th>
            <th>19mm B.B.</th>
            <th>25mm B.B.</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>8x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </section>
    <section>
      <h2>Centurian</h2>
      <table class="full-width-table" border="1">
        <thead>
          <tr>
            <th></th>
            <th colspan="6">Thickness</th>
          </tr>
          <tr>
            <th>Size</th>
            <th>6mm</th>
            <th>8mm</th>
            <th>12mm</th>
            <th>18mm</th>
            <th>19mm B.B.</th>
            <th>25mm B.B.</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>8x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x4</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>7x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>6x3</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </section>
    <section id="triple-core">
      <h2>Triple Core</h2>
      <table class="full-width-table" border="1">
        <thead>
          <tr>
            <th></th>
            <th colspan="12">Thickness</th>
          </tr>
          <tr>
            <th>Size</th>
            <th>24</th>
            <th>27</th>
            <th>30</th>
            <th>32</th>
            <th>33</th>
            <th>34</th>
            <th>36</th>
            <th>38</th>
            <th>39</th>
            <th>42</th>
            <th>45</th>
            <th>48</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>72</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>75</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>78</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>81</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>84</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>87</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>90</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>93</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>96</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </section>
    <section id="single-core">
      <h2>Single Core</h2>
      <table class="full-width-table" border="1">
        <thead>
          <tr>
            <th></th>
            <th colspan="12">Thickness</th>
          </tr>
          <tr>
            <th>Size</th>
            <th>24</th>
            <th>27</th>
            <th>30</th>
            <th>32</th>
            <th>33</th>
            <th>34</th>
            <th>36</th>
            <th>38</th>
            <th>39</th>
            <th>42</th>
            <th>45</th>
            <th>48</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>72</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>75</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>78</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>81</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>84</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>87</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>90</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>93</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>96</th>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </section>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const tables = document.querySelectorAll("table.full-width-table");

        // Fetch product data from the server for each brand
        const brands = [
          "Champion Max",
          "High Spirit",
          "Benz Club",
          "Centurian",
        ];
        brands.forEach((brand) => {
          fetch(`/products?brand=${brand}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          })
            .then((response) => response.json())
            .then((result) => {
              if (result.success) {
                const products = result.products;
                tables.forEach((table) => {
                  const sectionBrand = table
                    .closest("section")
                    .querySelector("h2")
                    .textContent.trim();
                  if (sectionBrand === brand) {
                    const name = table
                      .closest("section")
                      .querySelector("h2")
                      .textContent.trim();
                    populateTable(table, products, name);
                  }
                });
              } else {
                alert(result.message);
              }
            })
            .catch((error) => {
              console.error("Error fetching products:", error);
              alert("An error occurred while fetching products.");
            });
        });

        function populateTable(table, products, name) {
          const tbody = table.querySelector("tbody");
          const rows = tbody.querySelectorAll("tr");

          rows.forEach((row) => {
            const size = row.querySelector("th").textContent.trim();
            const cells = row.querySelectorAll("td");

            cells.forEach((cell, index) => {
              const thickness = table
                .querySelector(
                  `thead tr:nth-of-type(2) th:nth-of-type(${index + 2})`
                )
                .textContent.trim();
              const product = products.find(
                (p) =>
                  p.name === name &&
                  p.size === size &&
                  p.thickness === thickness
              );

              // If product found, populate quantity; otherwise, set it to 0
              cell.textContent = product ? product.quantity : 0;
            });
          });
        }

        // Fetch door data from the server
        function fetchDoorData() {
          fetch("/products?type=door", {
            headers: {
              Authorization: `Bearer ${localStorage.getItem("token")}`,
            },
          })
            .then((response) => response.json())
            .then((result) => {
              if (result.success) {
                const doorProducts = result.products.filter(
                  (product) => product.type === "door"
                );
                doorProducts.forEach((product) => {
                  const [width, height] = product.size
                    .split("x")
                    .map((part) => part.trim());

                  // Find the table for the brand
                  tables.forEach((table) => {
                    const sectionBrand = table
                      .closest("section")
                      .querySelector("h2")
                      .textContent.trim();
                    if (sectionBrand === product.name) {
                      // Find the row with matching width
                      const row = Array.from(
                        table.querySelectorAll("tbody tr")
                      ).find(
                        (row) =>
                          row.querySelector("th").textContent.trim() === width
                      );
                      if (row) {
                        // Find the column with matching height
                        const colIndex = Array.from(
                          table.querySelectorAll("thead tr:nth-of-type(2) th")
                        ).findIndex((th) => th.textContent.trim() === height);
                        if (colIndex > 0) {
                          // Write the quantity at the intersection of width and height
                          row.querySelectorAll("td")[colIndex - 1].textContent =
                            product.quantity;
                        }
                      }
                    }
                  });
                });

                // After processing all products, fill unset quantities with 0
                tables.forEach((table) => {
                  Array.from(table.querySelectorAll("tbody tr")).forEach(
                    (row) => {
                      Array.from(row.querySelectorAll("td")).forEach(
                        (cell, index) => {
                          if (cell.textContent.trim() === "") {
                            cell.textContent = "0";
                          }
                        }
                      );
                    }
                  );
                });
              } else {
                console.error("Error fetching door data:", result.message);
              }
            })
            .catch((error) => {
              console.error(
                "An error occurred while fetching door data:",
                error
              );
            });
        }

        fetchDoorData();
      });
    </script>
    <script src="script.js"></script>
  </body>
</html>
